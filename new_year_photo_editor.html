<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Ñ–æ—Ç–æ-—Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<style>
  body {
    margin: 0;
    font-family: 'Arial', sans-serif;
    background: url('https://images.unsplash.com/photo-1604079626808-9d0e35b0fdd3?auto=format&fit=crop&w=1950&q=80') no-repeat center center fixed;
    background-size: cover;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    color: #fff;
  }
  h1 {
    text-shadow: 2px 2px 6px #000;
  }
  .editor-container {
    background: rgba(0,0,0,0.6);
    padding: 20px;
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  canvas {
    border: 3px solid #fff;
    border-radius: 15px;
    margin-bottom: 20px;
    cursor: grab;
  }
  .controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }
  button, input[type="file"], select {
    padding: 10px 15px;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-size: 14px;
    background: rgba(255,255,255,0.2);
    color: #fff;
    transition: 0.3s;
  }
  button:hover, select:hover {
    background-color: rgba(255, 215, 0, 0.7);
  }
</style>
</head>
<body>
<h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —Ñ–æ—Ç–æ-—Ä–µ–¥–∞–∫—Ç–æ—Ä üéÑ</h1>
<div class="editor-container">
  <canvas id="canvas" width="600" height="600"></canvas>
  <div class="controls">
    <input type="file" id="upload" accept="image/*">
    <button onclick="addFrame('https://i.ibb.co/0mXvX7r/snowframe.png')">–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–º–∫—É ‚ùÑÔ∏è</button>
    <button onclick="addDecoration('https://i.ibb.co/8bXv5fP/santa-hat.png')">–®–∞–ø–∫–∞ –î–µ–¥–∞ –ú–æ—Ä–æ–∑–∞ üéÖ</button>
    <button onclick="addDecoration('https://i.ibb.co/1J2c5n5/elf-hat.png')">–®–∞–ø–∫–∞ —ç–ª—å—Ñ–∞ üßù</button>
    <button onclick="addDecoration('https://i.ibb.co/7kPrKqG/garland.png')">–ì–∏—Ä–ª—è–Ω–¥–∞ üéÄ</button>
    <button onclick="addDecoration('https://i.ibb.co/zsDk7gk/ball.png')">–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π —à–∞—Ä üéà</button>
    <select id="filterSelect" onchange="applyFilter()">
      <option value="">–§–∏–ª—å—Ç—Ä—ã</option>
      <option value="warm">–¢–µ–ø–ª—ã–π üîÜ</option>
      <option value="vintage">–í–∏–Ω—Ç–∞–∂ üì∑</option>
      <option value="grayscale">–ß/–ë ‚ö´‚ö™</option>
    </select>
    <button onclick="deleteObject()">–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ üóëÔ∏è</button>
    <button onclick="downloadImage()">–°–∫–∞—á–∞—Ç—å —Ñ–æ—Ç–æ üíæ</button>
  </div>
</div>

<script>
const canvas = new fabric.Canvas('canvas', { preserveObjectStacking: true });
let mainPhoto = null;

// –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ
document.getElementById('upload').addEventListener('change', function(e){
  const reader = new FileReader();
  reader.onload = function(event){
    fabric.Image.fromURL(event.target.result, function(img){
      img.set({ left: canvas.width/2, top: canvas.height/2, originX:'center', originY:'center', selectable:true });
      img.scaleToWidth(canvas.width);
      mainPhoto = img;
      canvas.clear();
      canvas.add(img);
      canvas.sendToBack(img);
      canvas.renderAll();
    }, { crossOrigin: 'anonymous' });
  }
  reader.readAsDataURL(e.target.files[0]);
});

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–º–∫–∏
function addFrame(url){
  fabric.Image.fromURL(url, function(img){
    img.set({ left: canvas.width/2, top: canvas.height/2, originX:'center', originY:'center', selectable:true });
    img.scaleToWidth(canvas.width);
    canvas.add(img);
    canvas.setActiveObject(img);
    canvas.renderAll();
  }, { crossOrigin: 'anonymous' });
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏–π
function addDecoration(url){
  fabric.Image.fromURL(url, function(img){
    img.set({ left: canvas.width/2, top: canvas.height/2, originX:'center', originY:'center', selectable:true });
    img.scale(0.2);
    canvas.add(img);
    canvas.setActiveObject(img);
    canvas.renderAll();
  }, { crossOrigin: 'anonymous' });
}

// –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Ñ–æ—Ç–æ
function applyFilter(){
  if(!mainPhoto) return;
  const filter = document.getElementById('filterSelect').value;
  mainPhoto.filters = [];
  if(filter === 'warm'){
    mainPhoto.filters.push(new fabric.Image.filters.Tint({ color: '#ffdfba', opacity:0.3 }));
  } else if(filter === 'vintage'){
    mainPhoto.filters.push(new fabric.Image.filters.Sepia());
  } else if(filter === 'grayscale'){
    mainPhoto.filters.push(new fabric.Image.filters.Grayscale());
  }
  mainPhoto.applyFilters();
  canvas.renderAll();
}

// –£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞
function deleteObject(){
  const active = canvas.getActiveObject();
  if(active){
    if(active === mainPhoto) mainPhoto = null;
    canvas.remove(active);
    canvas.renderAll();
  }
}

// –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
function downloadImage(){
  // –î–µ–ª–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
  const dataURL = canvas.toDataURL({ format:'png', multiplier:2 });
  const link = document.createElement('a');
  link.href = dataURL;
  link.download = 'newyear_photo.png';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

// –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–æ—Ç–æ –∫–æ–ª–µ—Å–∏–∫–æ–º –º—ã—à–∏
canvas.on('mouse:wheel', function(opt){
  if(!mainPhoto) return;
  const delta = opt.e.deltaY;
  let scale = mainPhoto.scaleX - delta/500;
  scale = Math.max(0.1, Math.min(5, scale));
  mainPhoto.scale(scale);
  canvas.renderAll();
  opt.e.preventDefault();
  opt.e.stopPropagation();
});

// –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤
canvas.on('object:moving', function(e){ e.target.setCoords(); });
canvas.on('object:scaling', function(e){ e.target.setCoords(); });
</script>
</body>
</html>

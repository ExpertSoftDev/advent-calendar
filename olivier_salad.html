<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ü–æ–π–º–∞–π –û–ª–∏–≤—å–µ</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: url("images/background.png") center / cover no-repeat fixed;
  }

  h1 {
    position: fixed;
    top: 10px;
    width: 100%;
    text-align: center;
    color: #fff;
    z-index: 20;
    text-shadow: 0 2px 8px rgba(0,0,0,.6);
  }

  /* ===== –ü–†–û–ì–†–ï–°–° ===== */
  #progress {
    position: fixed;
    top: 110px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 16px;
    z-index: 20;
  }

  #progress img {
    width: 56px;
    height: 56px;
    opacity: .3;
    filter: grayscale(1);
    transition: .3s;
  }

  #progress img.active {
    opacity: 1;
    filter: none;
  }

  /* ===== –¢–ê–†–ï–õ–ö–ê ===== */
  #plate-wrapper {
    position: fixed;
    bottom: -70px; /* ‚¨áÔ∏è –æ–ø—É—Å—Ç–∏–ª–∏ –µ—â—ë */
    left: 50%;
    transform: translateX(-50%);
    width: 38vw;
    max-width: 520px;
    min-width: 340px;
    z-index: 10;
    pointer-events: none;
  }

  #plate {
    width: 100%;
    display: block;
  }

  #plate-content {
    position: absolute;
    inset: 22% 15% 24% 15%;
  }

  #plate-content img {
    position: absolute;
    width: 120px;
    transition: transform .45s ease, opacity .45s ease;
    transform: scale(1.15);
  }

  /* ===== –ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ ===== */
  .ingredient {
    position: fixed;
    cursor: pointer;
    z-index: 5;
  }

  .needed { width: 125px; }
  .wrong { width: 95px; }

  /* ===== –û–®–ò–ë–ö–ê ===== */
  #error {
    position: fixed;
    inset: 0;
    background: rgba(255,0,0,.55);
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 90px;
    z-index: 30;
  }

  /* ===== –ü–û–ë–ï–î–ê ===== */
  #win {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.7);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 42px;
    z-index: 40;
  }

  #win button {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 18px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
  }

  canvas {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 35;
  }
</style>
</head>

<body>

<h1>ü•ó –ü–æ–π–º–∞–π –û–ª–∏–≤—å–µ</h1>

<div id="progress"></div>

<div id="plate-wrapper">
  <img id="plate" src="images/plate.png">
  <div id="plate-content"></div>
</div>

<div id="error">‚ùå</div>

<div id="win">
  üéâ –û–õ–ò–í–¨–ï –ì–û–¢–û–í!
  <button onclick="restartGame()">–°—ã–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
</div>

<canvas id="confetti"></canvas>

<script>
const neededNames = ['potato','carrot','egg','pickle','peas','sausage','mayo'];
const needed = neededNames.map(n => ({name:n, img:`images/${n}.png`, needed:true}));
const wrong = ['banana','apple','fish','cheese','donut','chili','cake']
  .map(n => ({name:n, img:`images/${n}.png`, needed:false}));

let collected = new Set();
let gameActive = true;
let spawnInterval;

/* ===== –ü–†–û–ì–†–ï–°–° ===== */
const progress = document.getElementById('progress');
needed.forEach(i => {
  const img = document.createElement('img');
  img.src = i.img;
  img.id = 'p-' + i.name;
  progress.appendChild(img);
});

function showError() {
  const e = document.getElementById('error');
  e.style.display = 'flex';
  setTimeout(() => e.style.display = 'none', 300);
}

/* ===== –ü–†–û–í–ï–†–ö–ê –ü–û–ü–ê–î–ê–ù–ò–Ø ===== */
function isOverPlate(el) {
  const plateRect = document.getElementById('plate').getBoundingClientRect();
  const elRect = el.getBoundingClientRect();

  const elCenterX = elRect.left + elRect.width / 2;

  return (
    elCenterX > plateRect.left &&
    elCenterX < plateRect.right
  );
}

/* ===== –ü–û–ë–ï–î–ê ===== */
function checkWin() {
  if (collected.size === neededNames.length) {
    gameActive = false;
    clearInterval(spawnInterval);
    document.getElementById('win').style.display = 'flex';
    startConfetti();
  }
}

/* ===== –ö–û–ù–§–ï–¢–¢–ò ===== */
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
let confetti = [];
let confettiActive = false;

function startConfetti() {
  confettiActive = true;
  canvas.width = innerWidth;
  canvas.height = innerHeight;

  confetti = Array.from({length: 260}, () => ({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*6+4,
    dx: Math.random()*4-2,
    dy: Math.random()*5+2,
    c: `hsl(${Math.random()*360},100%,50%)`
  }));

  (function animate(){
    if (!confettiActive) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach(p=>{
      p.x+=p.dx; p.y+=p.dy;
      if(p.y>canvas.height) p.y=-10;
      ctx.fillStyle=p.c;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
    });
    requestAnimationFrame(animate);
  })();
}

/* ===== –ò–ù–ì–†–ï–î–ò–ï–ù–¢ ===== */
function createIngredient() {
  if (!gameActive) return;

  const isNeeded = Math.random() < 0.65;
  const data = (isNeeded ? needed : wrong)[Math.floor(Math.random()*7)];

  const el = document.createElement('img');
  el.src = data.img;
  el.className = `ingredient ${data.needed?'needed':'wrong'}`;
  document.body.appendChild(el);

  const fromLeft = Math.random() > .5;
  let x = fromLeft ? -160 : innerWidth + 160;
  const endX = fromLeft ? innerWidth + 160 : -160;

  /* ‚¨áÔ∏è –ø–æ—Ç–æ–∫ –Ω–∏–∂–µ, –Ω–æ –≤—ã—à–µ —Ç–∞—Ä–µ–ª–∫–∏ */
  const y = 220 + Math.random() * (innerHeight * 0.28);

  el.style.left = x+'px';
  el.style.top = y+'px';

  const speed = 2 + Math.random()*2;
  const fly = setInterval(()=>{
    x += fromLeft ? speed : -speed;
    el.style.left = x+'px';
    if ((fromLeft && x>endX)||(!fromLeft&&x<endX)) {
      clearInterval(fly);
      el.remove();
    }
  },16);

  el.onclick = ()=>{
    clearInterval(fly);

    let top = el.getBoundingClientRect().top;
    const plateTop = document.getElementById('plate').getBoundingClientRect().top + 25;

    const fall = setInterval(()=>{
      top += 8;
      el.style.top = top+'px';

      const elRect = el.getBoundingClientRect();
      const centerY = elRect.top + elRect.height / 2;

      if (centerY >= plateTop) {
        clearInterval(fall);

        if (data.needed && isOverPlate(el)) {
          collected.add(data.name);
          document.getElementById('p-'+data.name).classList.add('active');

          const clone = el.cloneNode();
          clone.style.position = 'absolute';
          clone.style.left = Math.random()*55+'%';
          clone.style.top = Math.random()*55+'%';
          clone.style.opacity = 0;
          document.getElementById('plate-content').appendChild(clone);

          requestAnimationFrame(()=>{
            clone.style.opacity = 1;
            clone.style.transform = 'scale(1.25)';
          });

          el.remove();
          checkWin();
        } else {
          el.remove();
          showError();
        }
      }
    },16);
  };
}

/* ===== –†–ï–°–¢–ê–†–¢ ===== */
function restartGame() {
  collected.clear();
  gameActive = true;
  document.getElementById('win').style.display = 'none';

  confettiActive = false;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  document.querySelectorAll('.ingredient').forEach(i=>i.remove());
  document.querySelectorAll('#plate-content img').forEach(i=>i.remove());
  document.querySelectorAll('#progress img').forEach(i=>i.classList.remove('active'));

  spawnInterval = setInterval(createIngredient, 420);
}

spawnInterval = setInterval(createIngredient, 420);
</script>

</body>
</html>

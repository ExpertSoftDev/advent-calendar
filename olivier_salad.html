<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ü–æ–π–º–∞–π –û–ª–∏–≤—å–µ</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
    background: url("images/background.png") center / cover no-repeat fixed;
  }

  h1 {
    position: fixed;
    top: 10px;
    width: 100%;
    text-align: center;
    color: #fff;
    z-index: 20;
    text-shadow: 0 2px 8px rgba(0,0,0,.6);
  }

  /* ===== –ü–†–û–ì–†–ï–°–° ===== */
  #progress {
    position: fixed;
    top: 130px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 16px;
    z-index: 20;
  }

  #progress img {
    width: 60px;
    height: 60px;
    opacity: .3;
    filter: grayscale(1);
    transition: .3s;
  }

  #progress img.active {
    opacity: 1;
    filter: none;
  }

  /* ===== –¢–ê–†–ï–õ–ö–ê ===== */
  #plate-wrapper {
    position: fixed;
    bottom: -140px; /* ‚¨áÔ∏è –µ—â—ë –Ω–∏–∂–µ */
    left: 50%;
    transform: translateX(-50%);
    width: 40vw;
    max-width: 560px;
    min-width: 360px;
    z-index: 15;
    pointer-events: none;
  }

  #plate {
    width: 100%;
    display: block;
  }

  #plate-content {
    position: absolute;
    inset: 24% 16% 26% 16%;
  }

  #plate-content img {
    position: absolute;
    width: 120px;
    transform: scale(1.2);
    transition: transform .45s ease, opacity .45s ease;
  }

  /* ===== –ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ ===== */
  .ingredient {
    position: fixed;
    cursor: pointer;
    z-index: 5;
  }

  .needed { width: 135px; }
  .wrong  { width: 100px; }

  /* ===== –û–®–ò–ë–ö–ê ===== */
  #error {
    position: fixed;
    inset: 0;
    background: rgba(255,0,0,.55);
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 90px;
    z-index: 30;
  }

  /* ===== –ü–û–ë–ï–î–ê ===== */
  #win {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.7);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #fff;
    font-size: 42px;
    z-index: 40;
  }

  #win button {
    margin-top: 20px;
    padding: 12px 26px;
    font-size: 18px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
  }

  canvas {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 35;
  }

  /* ===== –ü–†–ê–í–ò–õ–ê ===== */
  #rules {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 240px;
    background: rgba(255,255,255,0.9);
    color: #333;
    padding: 12px 14px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.4;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    z-index: 25;
  }

  #rules h4 { margin: 0 0 6px; font-size: 15px; }
  #rules ul { margin: 0; padding-left: 16px; }
</style>
</head>

<body>

<h1>ü•ó –ü–æ–π–º–∞–π –û–ª–∏–≤—å–µ</h1>

<div id="progress"></div>

<div id="plate-wrapper">
  <img id="plate" src="images/plate.png">
  <div id="plate-content"></div>
</div>

<div id="error">‚ùå</div>

<div id="win">
  üéâ –û–õ–ò–í–¨–ï –ì–û–¢–û–í!
  <button onclick="restartGame()">–°—ã–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
</div>

<canvas id="confetti"></canvas>

<!-- ===== –ü–†–ê–í–ò–õ–ê ===== -->
<div id="rules">
  <h4>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h4>
  <ul>
    <li>–°–æ–±–µ—Ä–∏ —Å–∞–ª–∞—Ç –æ–ª–∏–≤—å–µ</li>
    <li>–ö–ª–∏–∫–∞–π —Ç–æ–ª—å–∫–æ –ø–æ –Ω—É–∂–Ω—ã–º –ø—Ä–æ–¥—É–∫—Ç–∞–º</li>
    <li>–ü—Ä–æ–¥—É–∫—Ç –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –æ–Ω –Ω–∞–¥ —Ç–∞—Ä–µ–ª–∫–æ–π</li>
    <li>–õ–∏—à–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã ‚Äî –æ—à–∏–±–∫–∞</li>
  </ul>
</div>

<!-- –ó–í–£–ö–ò -->
<audio id="soundPluh" src="sounds/pluh.mp3"></audio>
<audio id="soundWin" src="sounds/win.mp3"></audio>
<audio id="soundWrong" src="sounds/wrong.mp3"></audio>

<script>
const neededNames = ['potato','carrot','egg','pickle','peas','sausage','mayo'];
const needed = neededNames.map(n => ({name:n, img:`images/${n}.png`, needed:true}));
const wrong = ['banana','apple','fish','cheese','donut','chili','cake']
  .map(n => ({name:n, img:`images/${n}.png`, needed:false}));

let collected = new Set();
let gameActive = true;
let spawnInterval;

/* ===== –ó–í–£–ö–ò ===== */
const pluhSound = document.getElementById('soundPluh');
pluhSound.volume = 0.25;

const winSound = document.getElementById('soundWin');
winSound.volume = 0.3;

const wrongSound = document.getElementById('soundWrong');
wrongSound.volume = 0.25;

/* ===== –ü–†–û–ì–†–ï–°–° ===== */
const progress = document.getElementById('progress');
needed.forEach(i => {
  const img = document.createElement('img');
  img.src = i.img;
  img.id = 'p-' + i.name;
  progress.appendChild(img);
});

function showError() {
  const e = document.getElementById('error');
  e.style.display = 'flex';
  wrongSound.currentTime = 0;
  wrongSound.play();
  setTimeout(() => e.style.display = 'none', 300);
}

/* ===== –ü–†–û–í–ï–†–ö–ê –ù–ê–î –¢–ê–†–ï–õ–ö–û–ô ===== */
function isOverPlate(el) {
  const plateRect = document.getElementById('plate').getBoundingClientRect();
  const elRect = el.getBoundingClientRect();
  const centerX = elRect.left + elRect.width / 2;
  return centerX > plateRect.left && centerX < plateRect.right;
}

/* ===== –ü–û–ë–ï–î–ê ===== */
function checkWin() {
  if (collected.size === neededNames.length) {
    gameActive = false;
    clearInterval(spawnInterval);
    document.getElementById('win').style.display = 'flex';
    winSound.currentTime = 0;
    winSound.play();
    startConfetti();
  }
}

/* ===== –ö–û–ù–§–ï–¢–¢–ò ===== */
const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
let confetti = [];
let confettiActive = false;

function startConfetti() {
  confettiActive = true;
  canvas.width = innerWidth;
  canvas.height = innerHeight;

  confetti = Array.from({length: 260}, () => ({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*6+4,
    dx: Math.random()*4-2,
    dy: Math.random()*5+2,
    c: `hsl(${Math.random()*360},100%,50%)`
  }));

  (function animate(){
    if (!confettiActive) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach(p=>{
      p.x+=p.dx; p.y+=p.dy;
      if(p.y>canvas.height) p.y=-10;
      ctx.fillStyle=p.c;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
    });
    requestAnimationFrame(animate);
  })();
}

/* ===== –ò–ù–ì–†–ï–î–ò–ï–ù–¢–´ ===== */
function createIngredient() {
  if (!gameActive) return;

  const isNeeded = Math.random() < 0.65;
  const data = (isNeeded ? needed : wrong)[Math.floor(Math.random()*7)];

  const el = document.createElement('img');
  el.src = data.img;
  el.className = `ingredient ${data.needed?'needed':'wrong'}`;
  document.body.appendChild(el);

  const fromLeft = Math.random() > .5;
  let x = fromLeft ? -180 : innerWidth + 180;
  const endX = fromLeft ? innerWidth + 180 : -180;

  /* ‚¨áÔ∏è –ñ–Å–°–¢–ö–û –≤—ã—à–µ —Ç–∞—Ä–µ–ª–∫–∏ */
  const yMin = 260;
  const yMax = innerHeight * 0.45;
  const y = yMin + Math.random() * (yMax - yMin);

  el.style.left = x+'px';
  el.style.top = y+'px';

  const speed = 2 + Math.random()*2;
  const fly = setInterval(()=>{
    x += fromLeft ? speed : -speed;
    el.style.left = x+'px';
    if ((fromLeft && x>endX)||(!fromLeft&&x<endX)) {
      clearInterval(fly);
      el.remove();
    }
  },16);

  el.onclick = ()=>{
    clearInterval(fly);

    let top = el.getBoundingClientRect().top;
    const plateTop = document.getElementById('plate').getBoundingClientRect().top + 30;

    const fall = setInterval(()=>{
      top += 8;
      el.style.top = top+'px';

      const rect = el.getBoundingClientRect();
      const centerY = rect.top + rect.height / 2;

      if (centerY >= plateTop) {
        clearInterval(fall);

        if (data.needed && isOverPlate(el)) {
          pluhSound.currentTime = 0;
          pluhSound.play();

          collected.add(data.name);
          document.getElementById('p-'+data.name).classList.add('active');

          const clone = el.cloneNode();
          clone.style.position = 'absolute';
          clone.style.left = Math.random()*55+'%';
          clone.style.top = Math.random()*55+'%';
          clone.style.opacity = 0;
          document.getElementById('plate-content').appendChild(clone);

          requestAnimationFrame(()=>{
            clone.style.opacity = 1;
            clone.style.transform = 'scale(1.25)';
          });

          el.remove();
          checkWin();
        } else {
          el.remove();
          showError();
        }
      }
    },16);
  };
}

/* ===== –†–ï–°–¢–ê–†–¢ ===== */
function restartGame() {
  collected.clear();
  gameActive = true;
  document.getElementById('win').style.display = 'none';

  confettiActive = false;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  document.querySelectorAll('.ingredient').forEach(i=>i.remove());
  document.querySelectorAll('#plate-content img').forEach(i=>i.remove());
  document.querySelectorAll('#progress img').forEach(i=>i.classList.remove('active'));

  spawnInterval = setInterval(createIngredient, 420);
}

spawnInterval = setInterval(createIngredient, 420);
</script>

</body>
</html>

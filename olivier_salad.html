<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ò–≥—Ä–∞ –æ–ª–∏–≤—å–µ</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: sans-serif;
  }
  canvas {
    display: block;
    background: url('images/—Ñ–æ–Ω.png') no-repeat center center;
    background-size: cover;
  }

  #rules {
    position: fixed;
    top: 20px;
    right: 20px;
    width: 220px;
    background: rgba(255,255,255,0.9);
    color: #333;
    padding: 12px 14px;
    border-radius: 12px;
    font-size: 14px;
    line-height: 1.4;
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
    z-index: 10;
  }

  #rules h4 { margin: 0 0 6px; font-size: 15px; }
  #rules ul { margin: 0; padding-left: 16px; }

  #restartBtn {
    position: fixed;
    top: 60%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 12px 20px;
    font-size: 16px;
    background: #ffcc00;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    display: none;
    z-index: 20;
  }

  #progressContainer {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 24px;
    background: #ddd;
    border-radius: 12px;
    overflow: hidden;
  }

  #progressBar {
    height: 100%;
    width: 0%;
    background: #4caf50;
    border-radius: 12px;
    transition: width 0.3s;
  }
</style>
</head>
<body>

<div id="rules">
  <h4>–ö–∞–∫ –∏–≥—Ä–∞—Ç—å üçΩÔ∏è</h4>
  <ul>
    <li>–°–æ–±–µ—Ä–∏ —Å–∞–ª–∞—Ç –æ–ª–∏–≤—å–µ</li>
    <li>–ö–ª–∏–∫–∞–π —Ç–æ–ª—å–∫–æ –ø–æ –Ω—É–∂–Ω—ã–º –ø—Ä–æ–¥—É–∫—Ç–∞–º</li>
    <li>–ü—Ä–æ–¥—É–∫—Ç –∑–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –æ–Ω –Ω–∞–¥ —Ç–∞—Ä–µ–ª–∫–æ–π</li>
    <li>–õ–∏—à–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã ‚Äî –æ—à–∏–±–∫–∞</li>
  </ul>
</div>

<div id="progressContainer">
  <div id="progressBar"></div>
</div>

<button id="restartBtn">–ò–≥—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>

<audio id="soundPluh" src="sounds/pluh.mp3"></audio>
<audio id="soundWin" src="sounds/win.mp3"></audio>
<audio id="soundWrong" src="sounds/wrong.mp3"></audio>

<canvas id="gameCanvas"></canvas>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const soundPluh = document.getElementById('soundPluh');
const soundWin = document.getElementById('soundWin');
const soundWrong = document.getElementById('soundWrong');

const restartBtn = document.getElementById('restartBtn');
const progressBar = document.getElementById('progressBar');

const plateImg = new Image();
plateImg.src = 'images/—Ç–∞—Ä–µ–ª–∫–∞.png';

const productList = [
  {name:'–∫–∞—Ä—Ç–æ—à–∫–∞', src:'images/–∫–∞—Ä—Ç–æ—à–∫–∞.png', needed:true},
  {name:'–º–æ—Ä–∫–æ–≤–∫–∞', src:'images/–º–æ—Ä–∫–æ–≤–∫–∞.png', needed:true},
  {name:'—è–π—Ü–∞', src:'images/—è–π—Ü–∞.png', needed:true},
  {name:'–æ–≥—É—Ä—Ü—ã', src:'images/–æ–≥—É—Ä—Ü—ã.png', needed:true},
  {name:'–≥–æ—Ä–æ—à–µ–∫', src:'images/–≥–æ—Ä–æ—à–µ–∫.png', needed:true},
  {name:'–∫–æ–ª–±–∞—Å–∞', src:'images/–∫–æ–ª–±–∞—Å–∞.png', needed:true},
  {name:'–º–∞–π–æ–Ω–µ–∑', src:'images/–º–∞–π–æ–Ω–µ–∑.png', needed:true},
  // –ª–∏—à–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã
  {name:'–ª—É–∫', src:'images/–ª—É–∫.png', needed:false},
  {name:'–ø–æ–º–∏–¥–æ—Ä', src:'images/–ø–æ–º–∏–¥–æ—Ä.png', needed:false},
  {name:'—è–±–ª–æ–∫–æ', src:'images/—è–±–ª–æ–∫–æ.png', needed:false},
];

let products = [];
let collected = [];
let plate = {x:canvas.width/2, y:canvas.height*0.75, width:300, height:200};
let gameOver = false;

function resetGame() {
  products = [];
  collected = [];
  gameOver = false;
  restartBtn.style.display = 'none';
  progressBar.style.width = '0%';
  initProducts();
}

function initProducts() {
  const total = 20;
  const neededCount = Math.floor(total * 0.65);
  const allProducts = [];

  const neededProducts = productList.filter(p=>p.needed);
  const extraProducts = productList.filter(p=>!p.needed);

  for(let i=0;i<neededCount;i++){
    const p = neededProducts[Math.floor(Math.random()*neededProducts.length)];
    allProducts.push({...p, x:Math.random()*canvas.width, y:Math.random()*canvas.height*0.1, size:60, speed:1+Math.random()*2});
  }
  for(let i=neededCount;i<total;i++){
    const p = extraProducts[Math.floor(Math.random()*extraProducts.length)];
    allProducts.push({...p, x:Math.random()*canvas.width, y:Math.random()*canvas.height*0.1, size:60, speed:1+Math.random()*2});
  }
  products = allProducts;
}

function drawPlate() {
  ctx.drawImage(plateImg, plate.x - plate.width/2, plate.y - plate.height/2, plate.width, plate.height);
}

function drawProducts() {
  products.forEach(p=>{
    if(!p.collected){
      ctx.drawImage(p.img, p.x - p.size/2, p.y - p.size/2, p.size, p.size);
    }
  });
}

function updateProducts() {
  products.forEach(p=>{
    if(!p.collected){
      p.x += (p.dx || 1) || 0;
      if(!p.dx) p.dx = Math.random()<0.5?1:-1;
    }
  });
}

function checkClick(e){
  const rect = canvas.getBoundingClientRect();
  const mouseX = e.clientX - rect.left;
  const mouseY = e.clientY - rect.top;

  for(let p of products){
    if(!p.collected){
      const left = p.x - p.size/2;
      const right = p.x + p.size/2;
      const top = p.y - p.size/2;
      const bottom = p.y + p.size/2;

      if(mouseX>=left && mouseX<=right && mouseY>=top && mouseY<=bottom){
        // –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–∞–¥ —Ç–∞—Ä–µ–ª–∫–æ–π
        if(p.needed && mouseY < plate.y && mouseY > plate.y - plate.height){
          p.collected = true;
          // –ø–ª–∞–≤–Ω–æ–µ –ø–∞–¥–µ–Ω–∏–µ –≤ —Ç–∞—Ä–µ–ª–∫—É
          animateToPlate(p);
          soundPluh.currentTime = 0;
          soundPluh.play();
          updateProgress();
        } else {
          soundWrong.currentTime = 0;
          soundWrong.play();
        }
      }
    }
  }
}

function animateToPlate(product){
  const targetY = plate.y;
  const duration = 500;
  const startY = product.y;
  const startTime = performance.now();

  function animate(time){
    const elapsed = time - startTime;
    const t = Math.min(1, elapsed/duration);
    product.y = startY + t*(targetY - startY);
    product.size = 60 + t*(plate.height*0.3 - 60);
    if(t<1){
      requestAnimationFrame(animate);
    } else {
      checkWin();
    }
  }
  requestAnimationFrame(animate);
}

function updateProgress(){
  const neededTotal = productList.filter(p=>p.needed).length;
  const collectedCount = products.filter(p=>p.collected && p.needed).length;
  const percent = Math.round((collectedCount/neededTotal)*100);
  progressBar.style.width = percent+'%';
}

function checkWin(){
  const neededTotal = productList.filter(p=>p.needed).length;
  const collectedCount = products.filter(p=>p.collected && p.needed).length;
  if(collectedCount >= neededTotal){
    gameOver = true;
    soundWin.currentTime = 0;
    soundWin.play();
    confetti({
      particleCount: 150,
      spread: 70,
      origin: { y: 0.6 }
    });
    restartBtn.style.display = 'block';
  }
}

function loadImages(){
  products.forEach(p=>{
    const img = new Image();
    img.src = p.src;
    p.img = img;
  });
}

function animate(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawProducts();
  drawPlate();
  if(!gameOver){
    updateProducts();
  }
  requestAnimationFrame(animate);
}

canvas.addEventListener('click', checkClick);
restartBtn.addEventListener('click', resetGame);

resetGame();
loadImages();
animate();
</script>
</body>
</html>

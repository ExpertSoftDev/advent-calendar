<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Новогодний редактор</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>

<style>
    body {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: Arial, sans-serif;

        background: url("images/background.jpg") center/cover no-repeat fixed;

        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        padding: 20px;
    }

    /* Гирлянды */
    .garland {
        position: fixed;
        width: 280px;
        pointer-events: none;
        z-index: 10;
    }
    .garland.left { top: 0; left: 0; }
    .garland.right { top: 0; right: 0; transform: scaleX(-1); }

    .editor-container {
        width: 100%;
        max-width: 700px;
        background: rgba(0, 0, 0, 0.55);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 0 25px rgba(0,0,0,0.6);
    }

    canvas {
        border-radius: 12px;
        border: 2px solid #fff;
        display: block;
    }

    .controls {
        margin-top: 15px;
        text-align: center;
    }

    input[type="file"] {
        padding: 10px 12px;
        background: rgba(255,255,255,0.25);
        border-radius: 8px;
        border: none;
        color: #fff;
        cursor: pointer;
    }
</style>
</head>
<body>

    <!-- гирлянды -->
    <img src="images/garland-left.png" class="garland left">
    <img src="images/garland-right.png" class="garland right">

    <div class="editor-container">
        <canvas id="canvas"></canvas>

        <div class="controls">
            <input type="file" id="upload" accept="image/*">
        </div>
    </div>

<script>
    const canvas = new fabric.Canvas("canvas", {
        preserveObjectStacking: true
    });
    let mainPhoto = null;

    /* АДАПТИВ CANVAS */
    function resizeCanvas() {
        const size = document.querySelector(".editor-container").clientWidth;
        canvas.setWidth(size);
        canvas.setHeight(size);   // квадрат
        canvas.renderAll();

        if (mainPhoto) {
            mainPhoto.center();
            canvas.renderAll();
        }
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    /* ЗАГРУЗКА ФОТО */
    document.getElementById("upload").addEventListener("change", function(e) {
        const reader = new FileReader();
        reader.onload = function(event) {
            fabric.Image.fromURL(event.target.result, function(img) {
                mainPhoto = img;

                canvas.clear();

                const scale = Math.min(
                    canvas.width / img.width,
                    canvas.height / img.height
                );

                img.set({
                    left: canvas.width / 2,
                    top: canvas.height / 2,
                    originX: "center",
                    originY: "center"
                });

                img.scale(scale);

                canvas.add(img);
                canvas.sendToBack(img);
                canvas.renderAll();
            });
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    /* МАСШТАБ КОЛЕСИКОМ */
    canvas.on("mouse:wheel", function(opt) {
        if (!mainPhoto) return;

        let delta = opt.e.deltaY;
        let newScale = mainPhoto.scaleX - delta / 500;

        newScale = Math.max(0.1, Math.min(5, newScale));

        mainPhoto.scale(newScale);

        canvas.renderAll();

        opt.e.preventDefault();
        opt.e.stopPropagation();
    });

</script>
</body>
</html>

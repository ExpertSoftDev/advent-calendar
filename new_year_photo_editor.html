<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>–ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –§–æ—Ç–æ-–†–µ–¥–∞–∫—Ç–æ—Ä</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: url('images/background.jpg') center/cover no-repeat fixed;
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #fff;
  }

  .panel {
    margin-top: 20px;
    padding: 20px;
    background: rgba(0,0,0,0.4);
    border-radius: 16px;
    display: flex;
    gap: 20px;
  }

  canvas {
    border-radius: 16px;
    background: rgba(255,255,255,0.2);
    backdrop-filter: blur(10px);
  }

  .controls {
    padding: 20px;
    background: rgba(0,0,0,0.4);
    border-radius: 16px;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  select, button, input {
    padding: 8px 12px;
    border-radius: 8px;
    border: none;
    font-size: 14px;
  }
</style>
</head>
<body>

<h1>üéÑ –ù–æ–≤–æ–≥–æ–¥–Ω–∏–π –§–æ—Ç–æ-–†–µ–¥–∞–∫—Ç–æ—Ä üéÑ</h1>

<div class="panel">
  <canvas id="editor" width="700" height="500"></canvas>

  <div class="controls">
    <input type="file" id="upload" accept="image/*" />

    <label>–†–∞–º–∫–∞:</label>
    <select id="frameSelect">
      <option value="none">–ù–µ—Ç</option>
      <option value="frame-snow.png">–°–Ω–µ–∂–Ω–∞—è</option>
      <option value="frame-ice.png">–õ–µ–¥—è–Ω–∞—è</option>
      <option value="frame-garland.png">–ì–∏—Ä–ª—è–Ω–¥–∞</option>
    </select>

    <label>–£–∫—Ä–∞—à–µ–Ω–∏–µ:</label>
    <select id="decorSelect">
      <option value="none">–í—ã–±—Ä–∞—Ç—å —É–∫—Ä–∞—à–µ–Ω–∏–µ</option>
      <option value="hat-santa.png">–®–∞–ø–∫–∞ –°–∞–Ω—Ç—ã</option>
      <option value="hat-elf.png">–®–∞–ø–∫–∞ –≠–ª—å—Ñ–∞</option>
      <option value="ball-red.png">–®–∞—Ä –∫—Ä–∞—Å–Ω—ã–π</option>
      <option value="ball-blue.png">–®–∞—Ä —Å–∏–Ω–∏–π</option>
      <option value="snowflake.png">–°–Ω–µ–∂–∏–Ω–∫–∞</option>
      <option value="garland.png">–ì–∏—Ä–ª—è–Ω–¥–∞</option>
    </select>

    <label>–§–∏–ª—å—Ç—Ä:</label>
    <select id="filterSelect">
      <option value="none">–ù–µ—Ç</option>
      <option value="vintage">–í–∏–Ω—Ç–∞–∂</option>
      <option value="bw">–ß/–±</option>
    </select>

    <button id="download">–°–∫–∞—á–∞—Ç—å</button>
  </div>
</div>

<script>
const canvas = document.getElementById('editor');
const ctx = canvas.getContext('2d');

let photo = null;
let photoScale = 1;
let photoX = 0;
let photoY = 0;

let frame = null;

let decorations = [];

let currentFilter = 'none';

function render() {
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if (photo) {
    ctx.save();
    ctx.translate(canvas.width/2, canvas.height/2);
    ctx.scale(photoScale, photoScale);
    ctx.drawImage(photo, -photo.width/2, -photo.height/2);
    ctx.restore();
  }

  decorations.forEach(dec => {
    ctx.save();
    ctx.translate(dec.x, dec.y);
    ctx.scale(dec.scale, dec.scale);
    ctx.drawImage(dec.img, -dec.img.width/2, -dec.img.height/2);
    ctx.restore();
  });

  if (frame) {
    ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
  }

  if (currentFilter === 'vintage') {
    ctx.fillStyle = 'rgba(255, 220, 180, 0.2)';
    ctx.fillRect(0,0,canvas.width,canvas.height);
  }

  if (currentFilter === 'bw') {
    let imgData = ctx.getImageData(0,0,canvas.width,canvas.height);
    let d = imgData.data;
    for (let i=0; i<d.length; i+=4) {
      let avg = (d[i] + d[i+1] + d[i+2]) / 3;
      d[i] = d[i+1] = d[i+2] = avg;
    }
    ctx.putImageData(imgData,0,0);
  }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ
upload.addEventListener('change', e => {
  let file = e.target.files[0];
  if (!file) return;
  let img = new Image();
  img.onload = () => {
    photo = img;
    photoScale = 1;
    render();
  };
  img.src = URL.createObjectURL(file);
});

// –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ –∫–æ–ª–µ—Å–∏–∫–æ–º
canvas.addEventListener('wheel', e => {
  e.preventDefault();
  if (!photo) return;
  photoScale += e.deltaY * -0.001;
  if (photoScale < 0.2) photoScale = 0.2;
  render();
});

// –í—ã–±–æ—Ä —Ä–∞–º–∫–∏
document.getElementById('frameSelect').addEventListener('change', e => {
  let val = e.target.value;
  if (val === 'none') {
    frame = null;
    render();
    return;
  }
  let img = new Image();
  img.onload = () => {
    frame = img;
    render();
  };
  img.src = 'images/' + val;
});

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–∫—Ä–∞—à–µ–Ω–∏–π
document.getElementById('decorSelect').addEventListener('change', e => {
  let val = e.target.value;
  if (val === 'none') return;

  let img = new Image();
  img.onload = () => {
    decorations.push({
      img,
      x: canvas.width/2,
      y: canvas.height/2,
      scale: 1
    });
    render();
  };
  img.src = 'images/' + val;

  e.target.value = 'none';
});

// –§–∏–ª—å—Ç—Ä—ã
document.getElementById('filterSelect').addEventListener('change', e => {
  currentFilter = e.target.value;
  render();
});

// –°–∫–∞—á–∞—Ç—å

document.getElementById('download').addEventListener('click', () => {
  const link = document.createElement('a');
  link.download = 'edited-photo.png';
  link.href = canvas.toDataURL('image/png');
  link.click();
});

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ü–æ–π–º–∞–π –û–ª–∏–≤—å–µ</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    font-family: Arial, sans-serif;
    color: #fff;
    background: url("images/background.png") center / cover no-repeat fixed;
  }

  h1 {
    position: fixed;
    top: 10px;
    width: 100%;
    text-align: center;
    z-index: 20;
    text-shadow: 0 2px 8px rgba(0,0,0,0.6);
  }

  #plate {
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 33vw;
    max-width: 420px;
    min-width: 260px;
    z-index: 10;
    pointer-events: none;
  }

  .ingredient {
    position: fixed;
    cursor: pointer;
    user-select: none;
    z-index: 5;
  }

  .needed {
    width: 110px;
    height: 110px;
  }

  .wrong {
    width: 90px;
    height: 90px;
  }

  #error {
    position: fixed;
    inset: 0;
    background: rgba(255,0,0,0.55);
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 96px;
    z-index: 30;
  }

  #win {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    font-size: 42px;
    z-index: 40;
  }

  #win button {
    margin-top: 20px;
    padding: 12px 24px;
    font-size: 18px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }

  canvas {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 35;
  }
</style>
</head>

<body>

<h1>ü•ó –ü–æ–π–º–∞–π –û–ª–∏–≤—å–µ</h1>

<img id="plate" src="images/plate.png">
<div id="error">‚ùå</div>

<div id="win">
  üéâ –û–õ–ò–í–¨–ï –ì–û–¢–û–í!
  <button onclick="restartGame()">–°—ã–≥—Ä–∞—Ç—å –µ—â—ë —Ä–∞–∑</button>
</div>

<canvas id="confetti"></canvas>

<script>
const neededNames = ['potato','carrot','egg','pickle','peas','sausage','mayo'];

const needed = neededNames.map(n => ({name:n, img:`images/${n}.png`, needed:true}));
const wrong = [
  'banana','apple','fish','cheese','donut','chili','cake'
].map(n => ({name:n, img:`images/${n}.png`, needed:false}));

let collected = new Set();
let gameActive = true;
let spawnInterval;

/* ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–û–ï ===== */

function intersects(a, b) {
  const ar = a.getBoundingClientRect();
  const br = b.getBoundingClientRect();
  return !(ar.right < br.left || ar.left > br.right || ar.bottom < br.top || ar.top > br.bottom);
}

function showError() {
  const e = document.getElementById('error');
  e.style.display = 'flex';
  setTimeout(() => e.style.display = 'none', 300);
}

/* ===== –ö–û–ù–§–ï–¢–¢–ò ===== */

const canvas = document.getElementById('confetti');
const ctx = canvas.getContext('2d');
let confetti = [];

function startConfetti() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;

  confetti = Array.from({length: 250}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * canvas.height,
    r: Math.random() * 6 + 4,
    dx: Math.random() * 4 - 2,
    dy: Math.random() * 5 + 2,
    color: `hsl(${Math.random()*360},100%,50%)`
  }));

  function animate() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach(p => {
      p.x += p.dx;
      p.y += p.dy;
      if (p.y > canvas.height) p.y = -10;
      ctx.fillStyle = p.color;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fill();
    });
    if (!gameActive) requestAnimationFrame(animate);
  }
  animate();
}

/* ===== –ü–û–ë–ï–î–ê ===== */

function checkWin() {
  if (collected.size === neededNames.length) {
    gameActive = false;
    clearInterval(spawnInterval);
    document.getElementById('win').style.display = 'flex';
    startConfetti();
  }
}

/* ===== –°–û–ó–î–ê–ù–ò–ï –ò–ù–ì–†–ï–î–ò–ï–ù–¢–ê ===== */

function createIngredient() {
  if (!gameActive) return;

  const isNeeded = Math.random() < 0.65;
  const source = isNeeded ? needed : wrong;
  const data = source[Math.floor(Math.random() * source.length)];

  const el = document.createElement('img');
  el.src = data.img;
  el.className = `ingredient ${data.needed ? 'needed' : 'wrong'}`;
  el.dataset.name = data.name;
  document.body.appendChild(el);

  const fromLeft = Math.random() > 0.5;
  let x = fromLeft ? -120 : innerWidth + 120;
  const endX = fromLeft ? innerWidth + 120 : -120;
  const y = 120 + Math.random() * innerHeight * 0.4;

  el.style.left = x + 'px';
  el.style.top = y + 'px';

  const speed = 2 + Math.random() * 2;
  const fly = setInterval(() => {
    x += fromLeft ? speed : -speed;
    el.style.left = x + 'px';
    if ((fromLeft && x > endX) || (!fromLeft && x < endX)) {
      clearInterval(fly);
      el.remove();
    }
  }, 16);

  el.onclick = () => {
    clearInterval(fly);
    let yPos = el.getBoundingClientRect().top;
    const plate = document.getElementById('plate');

    const fall = setInterval(() => {
      yPos += 8;
      el.style.top = yPos + 'px';

      if (intersects(el, plate)) {
        clearInterval(fall);
        el.remove();
        if (data.needed) {
          collected.add(data.name);
          checkWin();
        } else {
          showError();
        }
      }

      if (yPos > innerHeight) {
        clearInterval(fall);
        el.remove();
        showError();
      }
    }, 16);
  };
}

/* ===== –ü–ï–†–ï–ó–ê–ü–£–°–ö ===== */

function restartGame() {
  collected.clear();
  gameActive = true;
  document.getElementById('win').style.display = 'none';
  ctx.clearRect(0,0,canvas.width,canvas.height);
  document.querySelectorAll('.ingredient').forEach(i => i.remove());
  spawnInterval = setInterval(createIngredient, 450);
}

/* ===== –°–¢–ê–†–¢ ===== */

spawnInterval = setInterval(createIngredient, 450);
</script>

</body>
</html>
